import scala.collection.mutable.Buffer

//function to get the current stop number
def getStopNumber[T](allStops: Buffer[T], curStop: Int): Int = (curStop) % allStops.length //circular count

//check if two drivers are at the same stop
def isSame[T](stopName1: T, stopName2: T): Boolean = stopName1 == stopName2

//function to get drivers and routes
def mapRouteToDriver(routes: String): Buffer[Buffer[String]] = {
  val splitRoutes = routes.split("\n").toBuffer
  val splitStops = splitRoutes.map(stops => stops.split(" ").toBuffer)
  println(s"There are ${splitRoutes.length} drivers in the simulation.\nBuffer = $splitStops")
  splitStops
}

//define a function that runs a loop to exchange the secrets
def runBusesComplex(rs: String): Unit = {
  var counter = 0 // used to check the current stop that the buses are
  val allRoutes = mapRouteToDriver(rs)
  val len = allRoutes.length
  val secrets = Buffer.fill(len, len)(false)

  //update  secrets to ensure each driver has their own secrets marked as true
  for (i<- 0 until secrets.length; j<- 0 until secrets(0).length) if (i==j) secrets(i)(j)=true

  //run until all secrets are true
  while (!secrets.forall(x=> x.forall(y=> y==true))){
    for(index <- 0 until len; index2 <- 0 until len){
      val stop1 = allRoutes(index % len)(getStopNumber(allRoutes(index % len),counter))
      val stop2 = allRoutes(index2 % len)(getStopNumber(allRoutes(index2 % len),counter))

      if (isSame(stop1,stop2)) {
        for (i <- 0 until secrets(index % len).length) {
          if ((secrets(index % len)(i) || secrets(index2 % len)(i))&&(index != index2)&& !(secrets(index % len)(i) && secrets(index2 % len)(i))) {
            secrets(index % len)(i) = true
            secrets(index2 % len)(i) = true
          }
        }
      }
    }
    //println(secrets)
    counter += 1
  }
  println(s"It took $counter stops to exchange all secrets")
}

runBusesComplex("12 6 8 9 10\n12 11 8 7\n33 6 8 9 7 12 32\n12 11 8 7\n12 11 8 7\n33 6 8 9 7 12 32")//\n33 6 8 9 7 12 32\n12 11 8 7\n33 6 8 9 7 12 32\n12 11 8 7\n33 6 8 9 7 12 32\n12 11 8 7\n33 6 8 9 7 12 32\n12 11 8 7\n33 6 8 9 7 12 32")
runBusesComplex("3 1 2 3\n3 2 3 1\n4 2 3 4 5")
runBusesComplex("12 23 15 2 8 20 21 3 23 3 27 20 0\n21 14 8 20 10 0 23 3 24 23 0 19 14 12 10 9 12 12 11 6 27 5\n8 18 27 10 11 22 29 23 14\n13 7 14 1 9 14 16 12 0 10 13 19 16 17")
runBusesComplex("12 23 15 2 8 20 21 3 23 3 27 20 0\n21 14 8 20 10 0 23 3 24 23 0 19 14 12 10 9 12 12 11 6 27 5\n8 18 27 10 11 22 29 23 14\n13 7 14 1 9 14 16 12 0 10 13 19 16 17\n24 25 21 4 6 19 1 3 26 11 22 28 14 14 27 7 20 8 7 4 1 8 10 18 21\n")//13 20 26 22 6 5 6 23 26 2 21 16 26 24\n6 7 17 2 22 23 21\n")//23 14 22 28 10 23 7 21 3 20 24 23 8 8 21 13 15 6 9 17 27 17 13 14\n")//23 13 1 15 5 16 7 26 22 29 17 3 14 16 16 18 6 10 3 14 10 17 27 25\n")//25 28 5 21 8 10 27 21 23 28 7 20 6 6 9 29 27 26 24 3 12 10 21 10 12 17\n")//26 22 26 13 10 19 3 15 2 3 25 29 25 19 19 24 1 26 22 10 17 19 28 11 22 2 13\n8 4 25 15 20 9 11 3 19\n24 29 4 17 2 0 8 19 11 28 13 4 16 5 15 25 16 5 6 1 0 19 7 4 6\n16 25 15 17 20 27 1 11 1 18 14 23 27 25 26 17 1")
runBusesComplex("12 23 15 2 8 20 21 3 23 3 27 20 0\n21 14 8 20 10 0 23 3 24 23 0 19 14 12 10 9 12 12 11 6 27 5\n8 18 27 10 11 22 29 23 14\n13 7 14 1 9 14 16 12 0 10 13 19 16 17\n24 25 21 4 6 19 1 3 26 11 22 28 14 14 27 7 20 8 7 4 1 8 10 18 21\n13 20 26 22 6 5 6 23 26 2 21 16 26 24\n6 7 17 2 22 23 21\n")//23 14 22 28 10 23 7 21 3 20 24 23 8 8 21 13 15 6 9 17 27 17 13 14\n")//23 13 1 15 5 16 7 26 22 29 17 3 14 16 16 18 6 10 3 14 10 17 27 25\n")//25 28 5 21 8 10 27 21 23 28 7 20 6 6 9 29 27 26 24 3 12 10 21 10 12 17\n")//26 22 26 13 10 19 3 15 2 3 25 29 25 19 19 24 1 26 22 10 17 19 28 11 22 2 13\n8 4 25 15 20 9 11 3 19\n24 29 4 17 2 0 8 19 11 28 13 4 16 5 15 25 16 5 6 1 0 19 7 4 6\n16 25 15 17 20 27 1 11 1 18 14 23 27 25 26 17 1")
runBusesComplex("12 23 15 2 8 20 21 3 23 3 27 20 0\n21 14 8 20 10 0 23 3 24 23 0 19 14 12 10 9 12 12 11 6 27 5\n8 18 27 10 11 22 29 23 14\n13 7 14 1 9 14 16 12 0 10 13 19 16 17\n24 25 21 4 6 19 1 3 26 11 22 28 14 14 27 7 20 8 7 4 1 8 10 18 21\n13 20 26 22 6 5 6 23 26 2 21 16 26 24\n6 7 17 2 22 23 21\n23 14 22 28 10 23 7 21 3 20 24 23 8 8 21 13 15 6 9 17 27 17 13 14\n")//23 13 1 15 5 16 7 26 22 29 17 3 14 16 16 18 6 10 3 14 10 17 27 25\n")//25 28 5 21 8 10 27 21 23 28 7 20 6 6 9 29 27 26 24 3 12 10 21 10 12 17\n")//26 22 26 13 10 19 3 15 2 3 25 29 25 19 19 24 1 26 22 10 17 19 28 11 22 2 13\n8 4 25 15 20 9 11 3 19\n24 29 4 17 2 0 8 19 11 28 13 4 16 5 15 25 16 5 6 1 0 19 7 4 6\n16 25 15 17 20 27 1 11 1 18 14 23 27 25 26 17 1")
runBusesComplex("12 23 15 2 8 20 21 3 23 3 27 20 0\n21 14 8 20 10 0 23 3 24 23 0 19 14 12 10 9 12 12 11 6 27 5\n8 18 27 10 11 22 29 23 14\n13 7 14 1 9 14 16 12 0 10 13 19 16 17\n24 25 21 4 6 19 1 3 26 11 22 28 14 14 27 7 20 8 7 4 1 8 10 18 21\n13 20 26 22 6 5 6 23 26 2 21 16 26 24\n6 7 17 2 22 23 21\n23 14 22 28 10 23 7 21 3 20 24 23 8 8 21 13 15 6 9 17 27 17 13 14\n23 13 1 15 5 16 7 26 22 29 17 3 14 16 16 18 6 10 3 14 10 17 27 25\n")//25 28 5 21 8 10 27 21 23 28 7 20 6 6 9 29 27 26 24 3 12 10 21 10 12 17\n")//26 22 26 13 10 19 3 15 2 3 25 29 25 19 19 24 1 26 22 10 17 19 28 11 22 2 13\n8 4 25 15 20 9 11 3 19\n24 29 4 17 2 0 8 19 11 28 13 4 16 5 15 25 16 5 6 1 0 19 7 4 6\n16 25 15 17 20 27 1 11 1 18 14 23 27 25 26 17 1")
runBusesComplex("12 23 15 2 8 20 21 3 23 3 27 20 0\n21 14 8 20 10 0 23 3 24 23 0 19 14 12 10 9 12 12 11 6 27 5\n8 18 27 10 11 22 29 23 14\n13 7 14 1 9 14 16 12 0 10 13 19 16 17\n24 25 21 4 6 19 1 3 26 11 22 28 14 14 27 7 20 8 7 4 1 8 10 18 21\n13 20 26 22 6 5 6 23 26 2 21 16 26 24\n6 7 17 2 22 23 21\n23 14 22 28 10 23 7 21 3 20 24 23 8 8 21 13 15 6 9 17 27 17 13 14\n23 13 1 15 5 16 7 26 22 29 17 3 14 16 16 18 6 10 3 14 10 17 27 25\n25 28 5 21 8 10 27 21 23 28 7 20 6 6 9 29 27 26 24 3 12 10 21 10 12 17\n")//26 22 26 13 10 19 3 15 2 3 25 29 25 19 19 24 1 26 22 10 17 19 28 11 22 2 13\n8 4 25 15 20 9 11 3 19\n24 29 4 17 2 0 8 19 11 28 13 4 16 5 15 25 16 5 6 1 0 19 7 4 6\n16 25 15 17 20 27 1 11 1 18 14 23 27 25 26 17 1")
runBusesComplex("12 23 15 2 8 20 21 3 23 3 27 20 0\n21 14 8 20 10 0 23 3 24 23 0 19 14 12 10 9 12 12 11 6 27 5\n8 18 27 10 11 22 29 23 14\n13 7 14 1 9 14 16 12 0 10 13 19 16 17\n24 25 21 4 6 19 1 3 26 11 22 28 14 14 27 7 20 8 7 4 1 8 10 18 21\n13 20 26 22 6 5 6 23 26 2 21 16 26 24\n6 7 17 2 22 23 21\n23 14 22 28 10 23 7 21 3 20 24 23 8 8 21 13 15 6 9 17 27 17 13 14\n23 13 1 15 5 16 7 26 22 29 17 3 14 16 16 18 6 10 3 14 10 17 27 25\n25 28 5 21 8 10 27 21 23 28 7 20 6 6 9 29 27 26 24 3 12 10 21 10 12 17\n26 22 26 13 10 19 3 15 2 3 25 29 25 19 19 24 1 26 22 10 17 19 28 11 22 2 13\n")//8 4 25 15 20 9 11 3 19\n24 29 4 17 2 0 8 19 11 28 13 4 16 5 15 25 16 5 6 1 0 19 7 4 6\n16 25 15 17 20 27 1 11 1 18 14 23 27 25 26 17 1")
runBusesComplex("12 23 15 2 8 20 21 3 23 3 27 20 0\n21 14 8 20 10 0 23 3 24 23 0 19 14 12 10 9 12 12 11 6 27 5\n8 18 27 10 11 22 29 23 14\n13 7 14 1 9 14 16 12 0 10 13 19 16 17\n24 25 21 4 6 19 1 3 26 11 22 28 14 14 27 7 20 8 7 4 1 8 10 18 21\n13 20 26 22 6 5 6 23 26 2 21 16 26 24\n6 7 17 2 22 23 21\n23 14 22 28 10 23 7 21 3 20 24 23 8 8 21 13 15 6 9 17 27 17 13 14\n23 13 1 15 5 16 7 26 22 29 17 3 14 16 16 18 6 10 3 14 10 17 27 25\n25 28 5 21 8 10 27 21 23 28 7 20 6 6 9 29 27 26 24 3 12 10 21 10 12 17\n26 22 26 13 10 19 3 15 2 3 25 29 25 19 19 24 1 26 22 10 17 19 28 11 22 2 13\n4\n")//24 29 4 17 2 0 8 19 11 28 13 4 16 5 15 25 16 5 6 1 0 19 7 4 6\n16 25 15 17 20 27 1 11 1 18 14 23 27 25 26 17 1")
runBusesComplex("12 23 15 2 8 20 21 3 23 3 27 20 0\n21 14 8 20 10 0 23 3 24 23 0 19 14 12 10 9 12 12 11 6 27 5\n8 18 27 10 11 22 29 23 14\n13 7 14 1 9 14 16 12 0 10 13 19 16 17\n24 25 21 4 6 19 1 3 26 11 22 28 14 14 27 7 20 8 7 4 1 8 10 18 21\n13 20 26 22 6 5 6 23 26 2 21 16 26 24\n6 7 17 2 22 23 21\n23 14 22 28 10 23 7 21 3 20 24 23 8 8 21 13 15 6 9 17 27 17 13 14\n23 13 1 15 5 16 7 26 22 29 17 3 14 16 16 18 6 10 3 14 10 17 27 25\n25 28 5 21 8 10 27 21 23 28 7 20 6 6 9 29 27 26 24 3 12 10 21 10 12 17\n26 22 26 13 10 19 3 15 2 3 25 29 25 19 19 24 1 26 22 10 17 19 28 11 22 2 13\n8 4 25 15 20 9 11 3 19\n24 29 4 17 2 0 8 19 11 28 13 4 16 5 15 25 16 5 6 1 0 19 7 4 6\n")//16 25 15 17 20 27 1 11 1 18 14 23 27 25 26 17 1")
runBusesComplex("12 23 15 2 8 20 21 3 23 3 27 20 0\n21 14 8 20 10 0 23 3 24 23 0 19 14 12 10 9 12 12 11 6 27 5\n8 18 27 10 11 22 29 23 14\n13 7 14 1 9 14 16 12 0 10 13 19 16 17\n24 25 21 4 6 19 1 3 26 11 22 28 14 14 27 7 20 8 7 4 1 8 10 18 21\n13 20 26 22 6 5 6 23 26 2 21 16 26 24\n6 7 17 2 22 23 21\n23 14 22 28 10 23 7 21 3 20 24 23 8 8 21 13 15 6 9 17 27 17 13 14\n23 13 1 15 5 16 7 26 22 29 17 3 14 16 16 18 6 10 3 14 10 17 27 25\n25 28 5 21 8 10 27 21 23 28 7 20 6 6 9 29 27 26 24 3 12 10 21 10 12 17\n26 22 26 13 10 19 3 15 2 3 25 29 25 19 19 24 1 26 22 10 17 19 28 11 22 2 13\n8 4 25 15 20 9 11 3 19\n24 29 4 17 2 0 8 19 11 28 13 4 16 5 15 25 16 5 6 1 0 19 7 4 6\n16 25 15 17 20 27 1 11 1 18 14 23 27 25 26 17 1")

////mapRouteToDriver("12 6 8 9 10\n11 12 8 7\n33 6 8 9 7 12 32")
//println(s"$counter>>> $stop1 + $stop2 + ${isSame(stop1,stop2)} + $index + $index2 secrets(${index % len})($i) = ${secrets(index % len)(i)} against secrets(${index2 % len})($i) = ${secrets(index2 % len)(i)} >>> ${secrets(index % len).filter(x => x==true)} & ${secrets(index % len).filter(x => x==true)}")
1 % 12
12 % 12
17 % 12